<!DOCTYPE html>
<html>
  <head>
    <title>Async await</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Quick Introduction to Async Await

---

# Agenda

1. Promises
2. Some examples
3. Async-Await

---

# Brief introduction to promises

```js
const p = new Promise(
    function (resolve, reject) { // (A)
        // this runs when promise is created
        if (···) {
            resolve(value); // success
        } else {
            reject(reason); // failure
        }
    });
``` 

![Right-aligned image](./assets/images/promise-resolve-reject.png)
???
Promise is a one shot thing.

There are two states.
---
# The Promise body executes immediately

```js
let promise = new Promise(function(resolve, reject) {
    // the function is executed automatically when the promise is constructed
  
    alert(resolve); // function () { [native code] }
    alert(reject);  // function () { [native code] }
  
    // after 1 second signal that the job is done with the result "done!"
    setTimeout(() => resolve("done!"), 1000);
  });
```
---

# Passing values thru promises

```js
asyncFunc()
.then(function (value1) {
    return 123;
})
.then(function (value2) {
    console.log(value2); // 123
});
```

Here we pass back a regular value
---
# Chaining multiple promises

You can do this
```js
asyncFunc1()
.then(result1 => {
    asyncFunc2()
    .then(result2 => {
        ···
    });
});
```
---

# Chaining promises
This is a bit nicer

```js
asyncFunc1()
.then(function (value1) {
    return asyncFunc2();
})
.then(function (value2) {
    ···
})
```

---
# Chaining promises
Or even this

```js
asyncFunc1()
.then(asyncFunc2)
.then(asyncFunc3)
```

---
# Errors using promises
```js
var jsonPromise = new Promise(function(resolve, reject) {
    // JSON.parse throws an error if you feed it some
    // invalid JSON, so this implicitly rejects:
    resolve(JSON.parse("This is sucky JSON"));
  });
  
  jsonPromise.then(function(data) {
    // This never happens:
    console.log("It worked!", data);
  }).catch(function(err) {
    // Instead, this happens:
    console.log("It failed!", err);
  })
```

---

# What will you see when you run this?

```js
// an immediately resolved promise
let promise = new Promise(resolve => resolve("done!")); 
promise.then(alert); 
alert('code finished');
```
???
Notes
---
# What will you see when you run this?

```js
// an immediately resolved promise
let promise = new Promise(resolve => resolve("done!")); 
promise.then(alert); 
alert('code finished');
```

You will see an alert with `code finished`, followed by a plain alert
???
Notes
---

# What is the bug here?

```js
function foo() {
    const promise = asyncFunc();
    promise.then(result => {
        
    });

    return promise;
}
```
---

# What is the bug here?

```js
function foo() {
    const promise = asyncFunc();
    promise.then(result => {
        
    });

    return promise;
}
```
We need to return the result of the `then()`.

---

# Quick examples

```js
function doubleAfter2Seconds(x) {
    return new Promise(resolve => {
      setTimeout(() => {
        resolve(x * 2);
      }, 2000);
    });
  }

doubleAfter2Seconds(10).then((r) => {
    console.log(r);
});
```
---

# Slightly more complicated example

What if we wanted to pass multiple values?

```js
let sum =   doubleAfter2Seconds(10)
          + doubleAfter2Seconds(20)
          + doubleAfter2Seconds(30);
console.log(sum);
```

---
# Slightly more complicated example

What if we wanted to pass multiple values?

```js
let sum =   doubleAfter2Seconds(10)
          + doubleAfter2Seconds(20)
          + doubleAfter2Seconds(30);
console.log(sum);
```
This won't work.
---
# Slightly more complicated example

What if we wanted to pass multiple values?

```js
function addPromise(x){
    return new Promise(resolve => {
      doubleAfter2Seconds(10).then((a) => {
        doubleAfter2Seconds(20).then((b) => {
          doubleAfter2Seconds(30).then((c) => {
            resolve(x + a + b + c);
          })
        })
      })
    });
  }
```
Welcome to callback hell, again...
---
# Slightly more complicated example

What if we wanted to pass multiple values?

```js
async function addAsync(x) {
    const a = await doubleAfter2Seconds(10);
    const b = await doubleAfter2Seconds(20);
    const c = await doubleAfter2Seconds(30);
    return x + a + b + c;
  }
```
---
#Async/Await
---


# Resources
[Test](http://exploringjs.com/es6/ch_promises.html#sec_three-ways-understanding-promises)

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>